---
import Search from "@/components/Search.astro";
import ThemeToggle from "@/components/ThemeToggle.astro";
import { menuLinks } from "@/site.config";
---

<header
	class="group relative z-50 mb-16 flex items-center justify-between"
	id="main-header"
>
	<!-- Logo 和网站标题 -->
	<a
		aria-current={Astro.url.pathname === "/" ? "page" : false}
		class="flex items-center gap-3 grayscale hover:filter-none"
		href="/"
	>
		<!-- 您的自定义 Logo -->
		<img
			src="/icon.svg"
			alt="Logo"
			class="h-10 w-10"
		/>
		<!-- 网站标题 -->
		<span class="text-xl font-bold sm:text-2xl">hxjx blog</span>
	</a>

	<!-- 右侧容器: 包含导航和移动端按钮 -->
	<div class="flex items-center">
		<!-- 导航菜单 -->
		<nav
			id="navigation-menu"
			class="absolute right-0 top-16 hidden w-auto min-w-[200px] flex-col items-stretch gap-4 rounded-md bg-bgColor/[.95] p-4 text-accent shadow-lg backdrop-blur group-[.menu-open]:flex sm:static sm:min-w-0 sm:w-auto sm:flex-row sm:items-center sm:bg-transparent sm:p-0 sm:shadow-none"
		>
			<!-- 导航链接 -->
			{
				menuLinks.map((link, index) => (
					<a
						aria-current={Astro.url.pathname === link.path ? "page" : false}
						class:list={[
							"px-4 py-2 text-right underline-offset-2 sm:py-0 sm:text-center sm:hover:underline",
							// 仅在桌面端为非首个链接添加左侧竖线
							{ "sm:border-l sm:border-gray-500": index > 0 },
						]}
						data-astro-prefetch
						href={link.path}
					>
						{link.title}
					</a>
				))
			}

			<!-- 分隔线 (仅在移动端菜单中显示) -->
			<hr class="border-gray-500/30 sm:hidden" />

			<!-- 搜索和主题切换 -->
			<div class="flex items-center justify-end gap-4 sm:ps-4">
				<Search />
				<ThemeToggle />
			</div>
		</nav>

		<!-- 移动端菜单按钮 -->
		<button
			aria-expanded="false"
			aria-haspopup="menu"
			aria-label="Open main menu"
			class="group relative ms-3 h-7 w-7 sm:hidden"
			id="toggle-navigation-menu"
			type="button"
		>
			<!-- 汉堡图标 (三横杠) -->
			<svg
				aria-hidden="true"
				class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
				fill="none"
				focusable="false"
				stroke="currentColor"
				stroke-width="1.5"
				viewBox="0 0 24 24"
				xmlns="http://www.w3.org/2000/svg"
			>
				<path
					d="M3.75 6.75h16.5M3.75 12h16.5M3.75 17.25h16.5"
					stroke-linecap="round"
					stroke-linejoin="round"></path>
			</svg>
			<!-- 关闭图标 -->
			<svg
				aria-hidden="true"
				class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
				fill="none"
				focusable="false"
				stroke="currentColor"
				stroke-width="1.5"
				viewBox="0 0 24 24"
				xmlns="http://www.w3.org/2000/svg"
			>
				<path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
			</svg>
		</button>
	</div>
</header>

<script>
	// 使用更传统、兼容性更好的方法来处理菜单点击事件
	document.addEventListener("DOMContentLoaded", () => {
		const headerEl = document.getElementById("main-header");
		const mobileButtonEl = document.getElementById("toggle-navigation-menu");

		if (headerEl && mobileButtonEl) {
			mobileButtonEl.addEventListener("click", () => {
				headerEl.classList.toggle("menu-open");
				const isExpanded = headerEl.classList.contains("menu-open");
				mobileButtonEl.setAttribute("aria-expanded", String(isExpanded));
			});
		}
	});
</script>

