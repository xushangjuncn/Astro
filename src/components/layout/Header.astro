---
import Search from "@/components/Search.astro";
import ThemeToggle from "@/components/ThemeToggle.astro";
import { menuLinks } from "@/site.config";
---

<header
	class="group relative z-50 mb-16 flex items-center justify-between"
	id="main-header"
>
	<!-- Logo 和网站标题 -->
	<a
		aria-current={Astro.url.pathname === "/" ? "page" : false}
		class="flex items-center gap-3 grayscale hover:filter-none"
		href="/"
	>
		<!-- 您的自定义 Logo -->
		<img
			src="/icon.svg"
			alt="Logo"
			class="h-10 w-10"
		/>
		<!-- 网站标题 -->
		<span class="text-xl font-bold sm:text-2xl">hxjx blog</span>
	</a>

	<!-- 导航容器 -->
	<div class="flex items-center">
		<!-- 导航菜单: 包含了链接、搜索和主题切换 -->
		<nav
			id="navigation-menu"
			class="absolute right-0 top-14 hidden w-full flex-col items-stretch gap-4 rounded-md bg-bgColor/[.9] p-4 text-accent shadow-lg backdrop-blur group-[.menu-open]:flex sm:static sm:w-auto sm:flex-row sm:items-center sm:divide-x sm:divide-gray-500 sm:bg-transparent sm:p-0 sm:shadow-none"
		>
			<!-- 导航链接 -->
			{
				menuLinks.map((link) => (
					<a
						aria-current={Astro.url.pathname === link.path ? "page" : false}
						class="px-4 py-2 text-right underline-offset-2 sm:py-0 sm:text-center sm:hover:underline"
						data-astro-prefetch
						href={link.path}
					>
						{link.title}
					</a>
				))
			}

			<!-- 搜索和主题切换 (唯一的实例) -->
			<div class="flex items-center justify-end gap-4 pt-2 sm:ps-4 sm:pt-0">
				<Search />
				<ThemeToggle />
			</div>
		</nav>

		<!-- 移动端菜单按钮 -->
		<button
			aria-expanded="false"
			aria-haspopup="menu"
			aria-label="Open main menu"
			class="group relative ms-3 h-7 w-7 sm:hidden"
			id="toggle-navigation-menu"
			type="button"
		>
			<!-- 汉堡图标 (已修复为三横杠) -->
			<svg
				aria-hidden="true"
				class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
				fill="none"
				focusable="false"
				stroke="currentColor"
				stroke-width="1.5"
				viewBox="0 0 24 24"
				xmlns="http://www.w3.org/2000/svg"
			>
				<path
					d="M3.75 6.75h16.5M3.75 12h16.5M3.75 17.25h16.5"
					stroke-linecap="round"
					stroke-linejoin="round"></path>
			</svg>
			<!-- 关闭图标 -->
			<svg
				aria-hidden="true"
				class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
				fill="none"
				focusable="false"
				stroke="currentColor"
				stroke-width="1.5"
				viewBox="0 0 24 24"
				xmlns="http://www.w3.org/2000/svg"
			>
				<path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
			</svg>
		</button>
	</div>
</header>

<script>
	// 使用更传统、兼容性更好的方法来处理菜单点击事件
	document.addEventListener("DOMContentLoaded", () => {
		const headerEl = document.getElementById("main-header");
		const mobileButtonEl = document.getElementById("toggle-navigation-menu");

		if (headerEl && mobileButtonEl) {
			mobileButtonEl.addEventListener("click", () => {
				headerEl.classList.toggle("menu-open");
				const isExpanded = headerEl.classList.contains("menu-open");
				mobileButtonEl.setAttribute("aria-expanded", String(isExpanded));
			});
		}
	});
</script>

