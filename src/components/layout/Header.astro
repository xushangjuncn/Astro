---
import Search from "@/components/Search.astro";
import ThemeToggle from "@/components/ThemeToggle.astro";
import { menuLinks } from "@/site.config";
---

<header
	class="group relative z-50 mb-16 flex items-center justify-between"
	id="main-header"
>
	<!-- Logo 和网站标题 -->
	<a
		aria-current={Astro.url.pathname === "/" ? "page" : false}
		class="flex shrink-0 items-center gap-3 grayscale hover:filter-none"
		href="/"
	>
		<img src="/icon.svg" alt="Logo" class="h-10 w-10" />
		<span class="text-xl font-bold sm:text-2xl">hxjx blog</span>
	</a>

	<!-- 移动端菜单按钮 -->
	<button
		aria-expanded="false"
		aria-haspopup="menu"
		aria-label="Open main menu"
		class="group relative z-20 h-7 w-7 sm:hidden"
		id="toggle-navigation-menu"
		type="button"
	>
		<!-- 汉堡图标 -->
		<svg aria-hidden="true" class="absolute top-1/2 left-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0" fill="none" focusable="false" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
			<path d="M3.75 6.75h16.5M3.75 12h16.5M3.75 17.25h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
		</svg>
		<!-- 关闭图标 (X) -->
		<svg aria-hidden="true" class="absolute top-1/2 left-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100" fill="none" focusable="false" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
			<path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
		</svg>
	</button>

	<!-- 导航菜单 -->
	<nav
		id="navigation-menu"
		class="
			invisible absolute top-14 right-0 flex w-auto min-w-[200px] origin-top-right scale-95 flex-col items-stretch gap-4 rounded-md bg-bgColor/[.95] p-4 text-accent opacity-0 shadow-lg backdrop-blur transition-all group-[.menu-open]:visible group-[.menu-open]:scale-100 group-[.menu-open]:opacity-100
			sm:visible sm:relative sm:top-0 sm:flex sm:min-w-0 sm:scale-100 sm:flex-row sm:items-center sm:gap-4 sm:bg-transparent sm:p-0 sm:opacity-100 sm:shadow-none
		"
	>
		<!-- 导航链接 (桌面端带分隔符) -->
		<div class="flex flex-col items-stretch gap-4 text-right sm:flex-row sm:items-center sm:text-left sm:divide-x sm:divide-gray-500">
			{
				menuLinks.map((link) => (
					<a
						aria-current={Astro.url.pathname === link.path ? "page" : false}
						class="px-4 py-2 underline-offset-2 sm:py-0 sm:hover:underline"
						data-astro-prefetch
						href={link.path}
					>
						{link.title}
					</a>
				))
			}
		</div>

		<!-- 分隔线 (仅在移动端菜单中显示) -->
		<hr class="border-gray-500/30 sm:hidden" />
		
		<!-- 搜索和主题切换 (确保它们总是并排) -->
		<div class="flex items-center justify-end gap-4">
			<Search />
			<ThemeToggle />
		</div>
	</nav>
</header>

<script>
	// Script 保持不变
	document.addEventListener("DOMContentLoaded", () => {
		const headerEl = document.getElementById("main-header");
		const mobileButtonEl = document.getElementById("toggle-navigation-menu");

		if (headerEl && mobileButtonEl) {
			mobileButtonEl.addEventListener("click", () => {
				headerEl.classList.toggle("menu-open");
				const isExpanded = headerEl.classList.contains("menu-open");
				mobileButtonEl.setAttribute("aria-expanded", String(isExpanded));
			});
		}
	});
</script>

